# Aerospike database configuration file.

service {
   user root
   group root
   pidfile /var/run/aerospike/asd.pid
   service-threads 4
   proto-fd-max 15000
   cluster-name redborder-aerospike
}

logging {
   # Log file must be an absolute path.
   file /var/log/aerospike/aerospike.log {
      context any info
   }
}

network {
   service {
      address <%= @ipaddress %>
      port <%= node["aerospike"]["port"] %>
   }
   heartbeat {
      # mode multicast
      # address <%= node["aerospike"]["multicast"] %>
      # port 9918
      # interface-address <%= @ipaddress %>

      mode mesh
      address <%= @ipaddress %>
      port 3002

      <% Array(@aerospike_ips).each do |ip| %>
      mesh-seed-address-port <%= ip %> 3002
      <% end %>

      interval 150
      timeout 10
   }

   fabric {
      port 3001
   }

   info {
      port 3003
   }
}

<% if @malware_enable %>
namespace malware {
   default-ttl 180d
   nsup-period 300
   replication-factor 2
   stop-writes-sys-memory-pct 90
   indexes-memory-budget 4G
   storage-engine device {
      file /opt/aerospike/data/aerospike.dat
      filesize <%= (@disk_size.to_i / 1024).to_i == 0 ? 1024 * 1024 : (@disk_size.to_i / 1024).to_i  %>K
      data-in-memory true
      stop-writes-avail-pct 10
      evict-used-pct 90
   }
}
<% end %>

namespace general {
   replication-factor 1
   stop-writes-sys-memory-pct 90
   default-ttl 1d
   nsup-period 120
   storage-engine memory {
      data-size 1G
   }
}