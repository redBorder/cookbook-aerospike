# Aerospike database configuration file.

service {
   user root
   group root
   paxos-single-replica-limit 1 # Number of nodes where the replica count is automatically reduced to 1.
   pidfile /var/run/aerospike/asd.pid
   service-threads 4
   transaction-queues 4
   transaction-threads-per-queue 4
   proto-fd-max 15000
}

logging {
   # Log file must be an absolute path.
   file /var/log/aerospike/aerospike.log {
      context any info
   }
}

network {
   service {
      address <%= @ipsync %>
      port 5000
   }
   heartbeat {
      # mode multicast
      # address <%= node["redBorder"]["manager"]["aerospike"]["multicast"] %>
      # port 9918
      # interface-address <%= @ipsync %>

      mode mesh
      address <%= @ipsync %>
      port 3002

<% @managers.each do |x| %>
      mesh-seed-address-port <%= x["default"]["ipaddress_sync"] %> 3002
<% end %>

      interval 150
      timeout 10
   }

   fabric {
      port 3001
   }

   info {
      port 3003
   }
}

<% if @malware_enable %>
namespace malware {
   replication-factor 2
   memory-size 4G
   storage-engine device {
      file /opt/aerospike/data/aerospike.dat
      filesize <%= (@disk_size.to_i / 1024).to_i == 0 ? 1024 * 1024 : (@disk_size.to_i / 1024).to_i  %>K
      data-in-memory true
   }
}
<% end %>

namespace general {
   replication-factor 1
   memory-size 1G
   default-ttl 1d
   storage-engine memory
}